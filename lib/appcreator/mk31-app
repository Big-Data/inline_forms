#/bin/bash
APPNAME=$1
echo "Creating Rails app: $1..."
echo "Working directory: `pwd`."
rails new $APPNAME
echo "Create $APPNAME/config/databse.yml..."
cat database.yml | sed "s/APPNAME/$APPNAME/g" > $APPNAME/config/database.yml
echo "Create Gemfile in $APPNAME..."
cp -v Gemfile $APPNAME
cd $APPNAME
echo "Working directory: `pwd`."
echo "Bundle install..."
bundle install
echo "Devise install..."
rails g devise:install
echo "Devise User model..."
rails g devise User
echo "Install ckeditor..."
rails g ckeditor:install
echo "Create config file in app/assets/javascripts/ckeditor/config.js"
mkdir app/assets/javascripts/ckeditor
cp ../config.js app/assets/javascripts/ckeditor
echo "Add remotipart to app/assets/javascripts/application.js..."
echo >> app/assets/javascripts/application.js
echo "//= require jquery.remotipart" >> app/assets/javascripts/application.js
echo >> app/assets/javascripts/application.js
echo "Paper_trail install..."
bundle exec rails generate paper_trail:install
echo "DROP ${APPNAME}_development database"
sudo mysqladmin drop ${APPNAME}_development
echo "CREATE ${APPNAME}_development database"  
sudo mysqladmin create ${APPNAME}_development
echo "GRANT permissions"
echo "GRANT ALL ON ${APPNAME}_development.* to '${APPNAME}'@'localhost' identified by '${APPNAME}';" | sudo mysql -v mysql
echo "FLUSH PRIVILEGES;" | sudo mysql mysql
echo "Migrating Devise and Versions"
bundle exec rake db:migrate
echo "Done! Now make your tables."
